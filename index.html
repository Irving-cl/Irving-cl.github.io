<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  

  
  <title>Cao Li&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Some study by interest, mainly on competitive programming, algorithm and developing.">
<meta name="keywords" content="Competitive programming, Algorithm, Software developing">
<meta property="og:type" content="website">
<meta property="og:title" content="Cao Li&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Cao Li&#39;s blog">
<meta property="og:description" content="Some study by interest, mainly on competitive programming, algorithm and developing.">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cao Li&#39;s blog">
<meta name="twitter:description" content="Some study by interest, mainly on competitive programming, algorithm and developing.">
  
    <link rel="alternate" href="/atom.xml" title="Cao Li&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Cao Li&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-geometry-basics" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/02/geometry-basics/" class="article-date">
  <time datetime="2018-07-02T15:00:08.000Z" itemprop="datePublished">2018-07-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/competitive-programming/">competitive programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/02/geometry-basics/">Geometry Basics</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Geometry is a important part in competitive programming. However, it doesn’t appear much in small races. That’s why I’m quite unfamiliar with it. But I’m convinced that I will have to handle these problems sooner or later.</p>
<p>This blog is just a very start of geometry. I collect some very basic things in geometry and we only talk about two-dimensional. All the vectors mentioned below are two-dimensional.</p>
<p>I would introduce:</p>
<ol start="0">
<li>Common data structure for geometry problems</li>
<li>Dot product</li>
<li>Cross product</li>
<li>Are the two vectors parallel</li>
<li>Is the point on the line or the segment</li>
<li>Get the cross point of two lines</li>
<li>Do the two segments touch each other</li>
</ol>
<h3 id="Common-data-structure"><a href="#Common-data-structure" class="headerlink" title="Common data structure"></a>Common data structure</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P</span> &#123;</span></span><br><span class="line">    db x,y;</span><br><span class="line">    P()&#123;&#125;</span><br><span class="line">    P(db xx,db yy):x(xx),y(yy)&#123;&#125;</span><br><span class="line">    P <span class="keyword">operator</span>+(P rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> P(x+rhs.x,y+rhs.y);</span><br><span class="line">    &#125;</span><br><span class="line">    P <span class="keyword">operator</span>-(P rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> P(x-rhs.x,y-rhs.y);</span><br><span class="line">    &#125;</span><br><span class="line">    P <span class="keyword">operator</span>*(db k) &#123;</span><br><span class="line">        <span class="keyword">return</span> P(k*x,k*y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">db <span class="title">dot</span><span class="params">(P rhs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x*rhs.x+y*rhs.y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">db <span class="title">det</span><span class="params">(P rhs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x*rhs.y-y*rhs.x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This is a really simple struct, but it is quite powerful. It enables us to implement geometry algorithm elegantly. One of the good parts of it is that it can be taken as both a <code>Point</code> as well as a <code>Two-dimensional vector</code>.</p>
<h3 id="Dot-product"><a href="#Dot-product" class="headerlink" title="Dot product"></a>Dot product</h3><p>$$ \overrightarrow{AB} \cdot \overrightarrow{AC} = a $$<br>The geometric meaning of dot product is the length(maybe negative) of the projection of one vector onto the other. The result of dot product is a <strong>value</strong>.</p>
<h3 id="Cross-product"><a href="#Cross-product" class="headerlink" title="Cross product"></a>Cross product</h3><p>$$ \overrightarrow{AB} \times \overrightarrow{AC} = \overrightarrow{AD} $$<br>The result of cross product is actually a <strong>vector</strong> which is perpendicular to the plane which is deterimined by the two vectors. But in two dimension, we can take the result as a <strong>value</strong> which is equal to the area of the parallelogram determined by the two vectors.</p>
<h3 id="Are-the-two-vectors-parallel"><a href="#Are-the-two-vectors-parallel" class="headerlink" title="Are the two vectors parallel"></a>Are the two vectors parallel</h3><p>This is quite simple. When two vectors are parallel, the area of the parallelogram formed by them is <strong>0</strong>. So we can use cross product to get the area of the parallelogram and tell if the two vectors are parallel.</p>
<h3 id="Is-the-point-on-the-line-or-the-segment"><a href="#Is-the-point-on-the-line-or-the-segment" class="headerlink" title="Is the point on the line or the segment"></a>Is the point on the line or the segment</h3><p>Let’s start with line.  Call the point to be judged <code>A</code>, and find any two points <code>B</code>,<code>C</code> on the line.<br>Obviously, if <code>A</code> is on the line, then we have:<br>$$ \overrightarrow{AB} \times \overrightarrow{AC} = 0 $$<br>Now let’s go with segment. We call the two endpoints of the segment <code>B</code>, <code>C</code> now.<br>If <code>A</code> is on the segment, <code>A</code> has to be on the line first. Then <code>B</code> and <code>C</code> should be on different sides of <code>A</code>. We can check this simply by:<br>$$ \overrightarrow{AB} \cdot \overrightarrow{AC} &lt;= 0 $$</p>
<h3 id="Get-the-cross-point-of-two-lines"><a href="#Get-the-cross-point-of-two-lines" class="headerlink" title="Get the cross point of two lines"></a>Get the cross point of two lines</h3><p>We need pay attention to whether the two lines are <strong>exactly the same line</strong> and whether they are <strong>parallel</strong> at first.<br>Say, <code>p1</code> and <code>p2</code> are two points one line 1.<br>Then we can represent any point on line 1 as: $ p_{1} + t \cdot (p_{2} - p_{1}) $.<br>And what we need to do is to calculate <code>t</code> to make the point on line 2.<br>We can calculate <code>t</code> as :<br>$$<br>t = \frac<br>{(q_{2} - q_{1}) \times (q_{1} - p_{1})}<br>{(q_{2} - q_{1}) \times (p_{2} - p_{1})}<br>$$<br>So the cross point is:<br>$$<br>p_{1} +<br>\frac<br>{(q_{2} - q_{1}) \times (q_{1} - p_{1})}<br>{(q_{2} - q_{1}) \times (p_{2} - p_{1})}<br>\cdot<br>(p_{2} - p_{1})<br>$$<br>I cannot explain clearly why it works. We can simply think the proportion of area of two parallelograms.</p>
<h3 id="Do-the-two-segments-touch-each-other"><a href="#Do-the-two-segments-touch-each-other" class="headerlink" title="Do the two segments touch each other"></a>Do the two segments touch each other</h3><p>Since we have <strong>4</strong> and <strong>5</strong>, we can do tell this easily. First, we get the cross point of the two lines where the two segments lie. Next, we judge if the cross point is on both segments. Really simple, right?</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/02/geometry-basics/" data-id="cjj4eq8cl0004fjjgabpnc0l1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/geometry/">geometry</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-max-flow-algorithm" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/30/max-flow-algorithm/" class="article-date">
  <time datetime="2018-06-30T01:16:14.000Z" itemprop="datePublished">2018-06-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/competitive-programming/">competitive programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/30/max-flow-algorithm/">Max Flow Algorithm</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Maximum</strong> flow is a important part of graph theory in competitive programming. There have been already thousands of articles and blogs teaching people the principle and the implementation of max flow. So I’m not going to elaborate these things again. This blog is just written to help me implement the max flow algorithm faster in a competition with less mistakes.</p>
<h2 id="Ford-Fulkson"><a href="#Ford-Fulkson" class="headerlink" title="Ford-Fulkson"></a>Ford-Fulkson</h2><p>The main idea of max flow algorithm is to find <strong>augmented path</strong> until there is no one. When we find an augmented path, we need to change the residual graph. We should reduce the capcity of each edge on the path and increase it on each reverse edge on it by the flow we found. So in the implementation we don’t need to store the current flow of each edge, we just need to store the capcity of them.<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">20005</span>,M=<span class="number">2000005</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> to,next,cap;</span><br><span class="line">&#125; e[N];</span><br><span class="line"><span class="keyword">int</span> head[N],tot;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_edge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> cap)</span> </span>&#123;</span><br><span class="line">    e[tot].to=v;</span><br><span class="line">    e[tot].cap=cap;</span><br><span class="line">    e[tot].next=head[u];</span><br><span class="line">    head[u]=tot++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">bool</span> vis[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> sink,<span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    vis[u]=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (u==sink) <span class="keyword">return</span> f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=head[u];i!=<span class="number">-1</span>;i=e[i].next) &#123;</span><br><span class="line">        <span class="keyword">int</span> to=e[i].to;</span><br><span class="line">        <span class="keyword">if</span> (!vis[to]&amp;&amp;e[i].cap&gt;<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> ff=dfs(to,min(f,e[i].cap));</span><br><span class="line">            <span class="keyword">if</span> (ff&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                e[i].cap-=cap;</span><br><span class="line">                e[i^<span class="number">1</span>].cap+=cap;</span><br><span class="line">                <span class="keyword">return</span> ff;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span>(head));</span><br><span class="line">    <span class="comment">// Build graph here</span></span><br><span class="line">    <span class="keyword">int</span> max_flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</span><br><span class="line">        <span class="keyword">int</span> ff=dfs(src,sink,INF);</span><br><span class="line">        <span class="keyword">if</span> (ff&gt;<span class="number">0</span>) max_flow+=ff;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"max_flow:%d\n"</span>,max_flow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Ford-Fulkson</strong> is fast enough in most cases. But sometime it cannot meet our requirements. That’s why we need <strong>Dinic</strong>.</p>
<h2 id="Dinic"><a href="#Dinic" class="headerlink" title="Dinic"></a>Dinic</h2><p>Two optimizations are used in <strong>Dinic</strong> which make it faster. One is<code>level</code> array and the other is <code>arc optimization</code>. I’m not going to elaborate how they work here. Different from <strong>Ford-Fulkson</strong>, it runs a <code>bfs</code> to build the <code>level graph</code> and then run <code>dfs</code> a couple of times(without initializing).<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">20005</span>,M=<span class="number">2000005</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> to,next,cap;</span><br><span class="line">&#125; e[N];</span><br><span class="line"><span class="keyword">int</span> head[N],tot;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_edge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> cap)</span> </span>&#123;</span><br><span class="line">    e[tot].to=v;</span><br><span class="line">    e[tot].cap=cap;</span><br><span class="line">    e[tot].next=head[u];</span><br><span class="line">    head[u]=tot++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> level[N],iter[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> src)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    <span class="built_in">memset</span>(level,<span class="number">-1</span>,<span class="keyword">sizeof</span>(level));</span><br><span class="line">    level[src]=<span class="number">0</span>;</span><br><span class="line">    q.push(src);</span><br><span class="line">    <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        <span class="keyword">int</span> cur=q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur];i!=<span class="number">-1</span>;i=e[i].next) &#123;</span><br><span class="line">            <span class="keyword">int</span> to=e[i].to;</span><br><span class="line">            <span class="keyword">if</span> (e[i].cap&gt;<span class="number">0</span>&amp;&amp;level[to]==<span class="number">-1</span>) &#123;</span><br><span class="line">                level[to]=level[cur]+<span class="number">1</span>;</span><br><span class="line">                q.push(to);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> sink,<span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u==sink) <span class="keyword">return</span> f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span>&amp; i=iter[u];i!=<span class="number">-1</span>;i=e[i].next) &#123;</span><br><span class="line">        <span class="keyword">int</span> to=e[i].to;</span><br><span class="line">        <span class="keyword">if</span> (e[i].cap&gt;<span class="number">0</span>&amp;&amp;level[u]&lt;level[to]) &#123;</span><br><span class="line">            <span class="keyword">int</span> ff=dfs(to,sink,min(f,e[i].cap));</span><br><span class="line">            <span class="keyword">if</span> (ff&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                e[i].cap-=ff;</span><br><span class="line">                e[i^<span class="number">1</span>].cap+=ff;</span><br><span class="line">                <span class="keyword">return</span> ff;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span>(head));</span><br><span class="line">    <span class="comment">// Build graph here</span></span><br><span class="line">    <span class="keyword">int</span> mx_flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        bfs();</span><br><span class="line">        <span class="keyword">if</span> (level[sink]==<span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) iter[i]=head[i];</span><br><span class="line">        <span class="keyword">int</span> ff;</span><br><span class="line">        <span class="keyword">while</span> ((ff=dfs(src,sink,INF)&gt;<span class="number">0</span>)) &#123;</span><br><span class="line">            mx_flow+=ff;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,mx_flow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/30/max-flow-algorithm/" data-id="cjj4eq8dg000wfjjgf2pdy5ol" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/max-flow/">max-flow</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cf-984E" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/10/cf-984E/" class="article-date">
  <time datetime="2018-06-10T14:24:38.000Z" itemprop="datePublished">2018-06-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/competitive-programming/">competitive programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/10/cf-984E/">Codeforces 984E Elevator</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The problem: <a href="http://codeforces.com/problemset/problem/984/E" target="_blank" rel="noopener">Codeforces 984E Elevator</a><br>I failed to solve the problem by myself although I believed it should be solved by dp immediately after I read the problem. The difficult and interesting part of this problem is how to arrange the <strong>state</strong> of the whole process so that the total number of <strong>state</strong> is as small as possible.<br>Let’s think about it. For a state transition, we need to know:</p>
<ol>
<li>How many people have got in the elevator(may have got out).</li>
<li>Current floor.</li>
<li>Which floors do people currently in the elevator want to go.</li>
</ol>
<p>The only problem is third one. There are at most 4 people in the elevator and each person may go to each of the 9 floors. So there would be<br>$$ 10^4=10000 $$<br>states in total in the 3rd dimension of dp.<br>However, it is a little bit more than we can afford. Actually some of the states in the above are repeated. Say, <code>person 1 goes to floor 3 and person 2 goes to floor 4</code> is the same as <code>person 1 goes to floor 4 and person 2 goes to 3</code>. So we only care about how many people go to each floor, with no need to know who. Hence the total number of state is:<br>$$ \binom{9}{0} + \binom{9}{1} + \binom{9}{2} + \binom{9}{3} + \binom{9}{4} = 256 $$</p>
<p>This enable us to get accepted.<br>And some technique should be adopted to represent the state. Instead of using integers, we use a 4-char-long string to represent a state. With the help of map, we can implement it nicely:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int_ int64_t</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ull unsigned ll</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> db double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MOD 1000003</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PII pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2010</span>;</span><br><span class="line"><span class="keyword">int</span> n,a[N],b[N];</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt; dp[N][<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> cur,<span class="keyword">const</span> <span class="built_in">string</span>&amp; s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (idx&gt;n&amp;&amp;s==<span class="string">"0000"</span>) &#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="keyword">int</span>&amp; res=dp[idx][cur][s];</span><br><span class="line">    <span class="keyword">if</span> (res) <span class="keyword">return</span> res;</span><br><span class="line">    res=INF;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> c=<span class="string">'1'</span>;c&lt;=<span class="string">'9'</span>;c++) &#123;</span><br><span class="line">        <span class="built_in">string</span> t=s;</span><br><span class="line">        <span class="keyword">int</span> x=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (t[i]==c) t[i]=<span class="string">'0'</span>,x++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> now=idx;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (t[i]==<span class="string">'0'</span>&amp;&amp;now&lt;=n&amp;&amp;a[now]+<span class="string">'0'</span>==c) &#123;</span><br><span class="line">                t[i]=b[now++]+<span class="string">'0'</span>;</span><br><span class="line">                x++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sort(t.begin(),t.end());</span><br><span class="line">        <span class="keyword">if</span> (idx==now&amp;&amp;t==s) <span class="keyword">continue</span>;</span><br><span class="line">        res=min(res,<span class="built_in">abs</span>(cur-(c-<span class="string">'0'</span>))+x+dfs(now,c-<span class="string">'0'</span>,t));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,a+i,b+i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,dfs(<span class="number">1</span>,<span class="number">1</span>,<span class="string">"0000"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/10/cf-984E/" data-id="cjj4eq8dd000ufjjg55kpg2ut" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/codeforces/">codeforces</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dynamic-programming/">dynamic programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/state-compression/">state compression</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cf-894B" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/25/cf-894B/" class="article-date">
  <time datetime="2017-11-25T08:49:59.000Z" itemprop="datePublished">2017-11-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/competitive-programming/">competitive programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/25/cf-894B/">Codeforces 894B Ralph And His Magic Field</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Well, I didn’t solve it myself though it’s only B problem in Div2… Fine, this sometimes happens, never mind. Just practice more.  </p>
<p>The problem is, how many different ways can we put integers in a <em>n \</em> m* block so that the products of each row and each column is 1 or -1. </p>
<p>Let’s see how to solve it. We can easily figure out that only 1 or -1 can be put into the block. Further, another important conclusion is that <strong>when k is -1, the answer is 0 if n and m have different parity</strong>. Why is that? This is not obvious for me. If we have <code>n</code> be odd and <code>m</code> be even, then we have an even number of -1 in total since we have an even number of columns. However, we have an odd number of rows, and in each row there exists an odd number of -1. So the total number of -1 cannot be even. That’s impossible.  For the rest cases, we consider the (n-1)*(m-1) subblock. We can fill either 1 or -1 into any cell. And then the rest cells are determined.<br>The answer is:<br>$$<br>2^{(n-1)+(m-1)}<br>$$</p>
<p>With quick power, we can solve it easily.<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ull unsigned ll</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> db double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PII pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"></span><br><span class="line">ll n,m,k;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qp</span><span class="params">(ll temp,ll x)</span> </span>&#123;</span><br><span class="line">    ll ret=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (x&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x&amp;<span class="number">1</span>) ret=(ret*temp)%MOD;</span><br><span class="line">        temp=(temp*temp)%MOD;</span><br><span class="line">        x&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%lld%lld%lld"</span>,&amp;n,&amp;m,&amp;k);</span><br><span class="line">    <span class="keyword">if</span> (k==<span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((n%<span class="number">2</span>)+(m%<span class="number">2</span>)==<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ll ans=qp(qp(<span class="number">2</span>,n<span class="number">-1</span>),m<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>I’m recently studying using <strong>ocaml</strong>, which is a functional language.<br>So let’s rewrite the solution with <strong>ocaml</strong>.<br><figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="type">Scanf</span></span><br><span class="line"><span class="keyword">open</span> <span class="type">Printf</span></span><br><span class="line"><span class="keyword">open</span> <span class="type">Int64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> md = <span class="number">1000000007L</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f n m k =</span><br><span class="line">  <span class="keyword">if</span> k = -<span class="number">1L</span> &amp;&amp; <span class="type">Int64</span>.rem (<span class="type">Int64</span>.add m n) <span class="number">2L</span> = <span class="number">1L</span> <span class="keyword">then</span> <span class="number">0L</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">let</span> <span class="keyword">rec</span> g x y =</span><br><span class="line">      <span class="keyword">if</span> y = <span class="number">0L</span> <span class="keyword">then</span> <span class="number">1L</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> y = <span class="number">1L</span> <span class="keyword">then</span> x</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">let</span> tmp = g x (<span class="type">Int64</span>.div y <span class="number">2L</span>) <span class="keyword">in</span></span><br><span class="line">          <span class="keyword">if</span> <span class="type">Int64</span>.rem y <span class="number">2L</span> = <span class="number">0L</span> <span class="keyword">then</span> <span class="type">Int64</span>.rem (<span class="type">Int64</span>.mul tmp tmp) md </span><br><span class="line">          <span class="keyword">else</span> <span class="type">Int64</span>.rem (<span class="type">Int64</span>.mul (<span class="type">Int64</span>.rem (<span class="type">Int64</span>.mul tmp tmp) md) x) md <span class="keyword">in</span></span><br><span class="line">    g (g <span class="number">2L</span> (<span class="type">Int64</span>.sub n <span class="number">1L</span>)) (<span class="type">Int64</span>.sub m <span class="number">1L</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="literal">()</span> =</span><br><span class="line">  <span class="keyword">let</span> ans = bscanf <span class="type">Scanning</span>.stdin <span class="string">"%Ld %Ld %Ld"</span> f <span class="keyword">in</span></span><br><span class="line">    printf <span class="string">"%Ld\n"</span> ans</span><br></pre></td></tr></table></figure><br>Though it may be very difficult to use it in a contest temporarily, I have a great interest in this language.<br>The problem: <a href="http://codeforces.com/problemset/problem/894/B" target="_blank" rel="noopener">Codeforces 894B Ralph And His Magic Field</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/11/25/cf-894B/" data-id="cjj4eq8dc000sfjjg8du1gwun" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ad-hoc/">ad-hoc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/codeforces/">codeforces</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-notes-on-muduo-timer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/07/notes-on-muduo-timer/" class="article-date">
  <time datetime="2017-11-07T03:41:55.000Z" itemprop="datePublished">2017-11-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/07/notes-on-muduo-timer/">Notes on Muduo Timer</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recently I am studying <a href="https://github.com/chenshuo/muduo" target="_blank" rel="noopener">Muduo</a>, a net library written by ChenShuo.<br>And I think the timer system of it is worth learning, so I did some notes on it in this article.</p>
<h2 id="What-is-a-timer"><a href="#What-is-a-timer" class="headerlink" title="What is a timer?"></a>What is a timer?</h2><p><em>A timer allows us to do something at a specific time later.</em>  This is not quoted from someone’s words. This is just my own understanding. Say, now we want to run a function, instead of running it immediately, we want to run it after 2 seconds. And a timer enables us to do something like that.</p>
<h2 id="How-do-we-use-timer-in-Muduo"><a href="#How-do-we-use-timer-in-Muduo" class="headerlink" title="How do we use timer in Muduo?"></a>How do we use timer in Muduo?</h2><p>At the very beginning, we have to know a very important idea about Muduo: <strong>One loop per thread</strong>, which is also emphasized by the author. The core class of Muduo is <code>EventLoop</code>. Each <code>EventLoop</code> is bind to a thread and will loop forever to run the thread until we call the <code>quit()</code> method of it. Every thing runs in one of the EventLoops in Muduo. So, if we want to run a function in 2 seconds, we run the function in one of the EventLoops. Apparently, we run our functions in some thread.<br>Muduo provides us with three methods to add a timer and one to cancel a timer:<br><figure class="highlight cpp"><figcaption><span>interfaces</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Runs callback at 'time'.</span></span><br><span class="line"><span class="comment">/// Safe to call from other threads.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="function">TimerId <span class="title">runAt</span><span class="params">(<span class="keyword">const</span> Timestamp&amp; time, <span class="keyword">const</span> TimerCallback&amp; cb)</span></span>;</span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Runs callback after @c delay seconds.</span></span><br><span class="line"><span class="comment">/// Safe to call from other threads.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="function">TimerId <span class="title">runAfter</span><span class="params">(<span class="keyword">double</span> delay, <span class="keyword">const</span> TimerCallback&amp; cb)</span></span>;</span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Runs callback every @c interval seconds.</span></span><br><span class="line"><span class="comment">/// Safe to call from other threads.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="function">TimerId <span class="title">runEvery</span><span class="params">(<span class="keyword">double</span> interval, <span class="keyword">const</span> TimerCallback&amp; cb)</span></span>;</span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Cancels the timer.</span></span><br><span class="line"><span class="comment">/// Safe to call from other threads.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cancel</span><span class="params">(TimerId timerId)</span></span>;</span><br></pre></td></tr></table></figure><br>It would be unnessary to explain what does every above method do. However, I should still explain something else:</p>
<ul>
<li>A <code>Timer</code> is actually an expiration time with a callback function. The callback function would be called when it expired. </li>
<li>A <code>TimerId</code> is an identification of a timer so that we can cancel a timer.</li>
<li><code>Timestamp</code> is actually micro seconds since epoch.</li>
<li><code>TimerCallback</code> is a function object, which we want to run in the future.</li>
</ul>
<h2 id="How-does-these-timer-function-work"><a href="#How-does-these-timer-function-work" class="headerlink" title="How does these timer function work?"></a>How does these timer function work?</h2><p>Now we come to the critical and interesting part, let’s try to figure out how our functions are called when their time expired. In this section, we will take a look at the whole process, from the moment a timer was added to the moment its callback was called. Firstly, I need to introduce the core class of the timer system: <code>TimerQueue</code>. It is invisible to the clients.<br>The private members of it is as follow:<br><figure class="highlight cpp"><figcaption><span>members</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">FIXME:</span> use unique_ptr&lt;Timer&gt; instead of raw pointers.</span></span><br><span class="line"><span class="comment">// This requires heterogeneous comparison lookup (N3465) from C++14</span></span><br><span class="line"><span class="comment">// so that we can find an T* in a set&lt;unique_ptr&lt;T&gt;&gt;.</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::pair&lt;Timestamp, Timer*&gt; Entry;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">set</span>&lt;Entry&gt; TimerList;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::pair&lt;Timer*, <span class="keyword">int64_t</span>&gt; ActiveTimer;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">set</span>&lt;ActiveTimer&gt; ActiveTimerSet;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addTimerInLoop</span><span class="params">(Timer* timer)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cancelInLoop</span><span class="params">(TimerId timerId)</span></span>;</span><br><span class="line"><span class="comment">// called when timerfd alarms</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">handleRead</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// move out all expired timers</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Entry&gt; getExpired(Timestamp now);</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Entry&gt;&amp; expired, Timestamp now)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">insert</span><span class="params">(Timer* timer)</span></span>;</span><br><span class="line"></span><br><span class="line">EventLoop* loop_;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> timerfd_;</span><br><span class="line">Channel timerfdChannel_;</span><br><span class="line"><span class="comment">// Timer list sorted by expiration</span></span><br><span class="line">TimerList timers_;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for cancel()</span></span><br><span class="line">ActiveTimerSet activeTimers_;</span><br><span class="line"><span class="keyword">bool</span> callingExpiredTimers_; <span class="comment">/* atomic */</span></span><br><span class="line">ActiveTimerSet cancelingTimers_;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>I am not going to elaborate every member here. I put the code here because I may refer to some of these members later. Now we see the whole process. Actually, the problem is all about how to make our thread waked up when time is up.</p>
<h4 id="How-to-do-that"><a href="#How-to-do-that" class="headerlink" title="How to do that?"></a>How to do that?</h4><p>The way Muduo use to do such thing is quite different from what I once did. I once used two stupid methods, <code>sleep</code> and <code>busy loop and judge</code>. They are bad as far as accuracy is concerned. Besides, they are quite ‘low’ and ‘unprofessional’, right? Students may do that. But we need to be  professional. Muduo uses <code>timerfd</code> with <code>poll</code>. When I refer to <code>poll</code>, I mean <code>select</code>, <code>poll</code>, <code>epoll</code>. They are provided by linux system. If you are not clear about them, man them on a linux system or search the internet. I assumed you know the basic things about <code>poll</code> here.<br>However, <code>timerfd</code> is something new to me. A <code>timerfd</code> is a special file descriptor which will become readable when the time we set expires. It is done by the linux system. Wow, wonderful! This enables us to take an expiration as the same thing with an I/O event. And we can detect these events with <code>poll</code>.</p>
<h4 id="How-to-add-a-Timer"><a href="#How-to-add-a-Timer" class="headerlink" title="How to add a Timer?"></a>How to add a Timer?</h4><ol>
<li>At the very beginning, we create a timerfd by calling <code>timerfd_create</code> of linux. This is done only once. But we may set the timerfd many times later. We may have a lot of timers, and we want to be notified when the earliest one of them expired.</li>
<li>Insert the timer into the data structure we use to store them, which is <code>timers_</code> here. As you can see, there is another member <code>activeTimers_</code>. Unfortunately I don’t understand what is it for. But it doesn’t matter. Notice the definition of <code>TimerList</code> and <code>Entry</code>. <code>TimerList</code> is a set of <code>Entry</code>. An <code>std::set</code> is an ordered container implemented by RBTree. We store entries in it so that they can be sorted by their expiration time, which is represented by a <code>Timestamp</code>. Considering different timers may have the same timestamp, we make pair a timestamp with a pointer of the timer. This ensures us no collisions between timers.</li>
<li>Reset the <code>timerfd</code> if necessary. This should be done when the latest inserted timer would expire earliest. We do this by calling linux function <code>timerfd_settime</code>.  </li>
</ol>
<h4 id="How-to-call-the-callbacks-when-they-expired"><a href="#How-to-call-the-callbacks-when-they-expired" class="headerlink" title="How to call the callbacks when they expired?"></a>How to call the callbacks when they expired?</h4><p>As I mentioned above, a timerfd is treated as a normal fd. And we use <code>poll</code> function to detect that. By the way, let’s take a look at Muduo’s thread model. Muduo is of the <code>Reactor</code> Pattern.<br>Every single loop of <code>EventLoop</code> looks like this:<br><img src="https://raw.githubusercontent.com/Irving-cl/blog_assets/master/notes_on_muduo_timer/muduo_reactor.png" alt="img"></p>
<ol>
<li>At first, a poller will poll all the fds and update the channels. A channel can be seen as a bridge between low-level I/O and high-level callbacks; Notice that there is a <code>timerfdChannel_</code> in TimerQueue’s members. Once the time we set expired, the <code>timerfdChannel_</code> will be updated.</li>
<li>After that, <code>timerfdChannel_</code> found that the fd it took charge became readable, it call its handleRead function.</li>
<li>In its handleRead function, it will remove all the expired timers and run their callbacks. Of course, we should also read the timerfd and reset it.   </li>
</ol>
<p>Now I think we have a general idea about how muduo timer works. The core of the implementation is <code>timerfd</code>, <code>poll</code> and <code>Reactor</code> pattern. Thanks for reading!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/11/07/notes-on-muduo-timer/" data-id="cjj4eq8de000vfjjgchmd9jr4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cpp/">cpp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/net/">net</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cf-869C" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/10/cf-869C/" class="article-date">
  <time datetime="2017-10-10T06:59:00.000Z" itemprop="datePublished">2017-10-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/competitive-programming/">competitive programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/10/cf-869C/">Codeforces 869C The Intriguing Obsession</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>At first I got stuck with this problem.So I considered a simple case when there are only islands of two colors(c = 0).And it is easy to calculate the number of different ways under the constraints.</p>
<p>Suppose we only have islands with red and blue. Since we can only build bridges between a red island and a blue island, and further, we can only connect one blue island with one specific red island (otherwise distance between two blue islands is 2). And vice versa. Let <code>f(i)</code> be the number of different ways to build bridges when there are i bridges between red islands and blue islands.</p>
<p>Then we have:<br>$$<br>f(i) = C_a^i \cdot C_b^i \cdot i!<br>$$<br>Since we can pick i islands from red ones and i islands from blue ones, and we permutate i islands to match them.And the total number of it is:<br>$$<br>\sum_i^{min(a,b)} f(i)<br>$$</p>
<p>And next, we need to do with three colors. Try to add bridges between red islands and purple ones, and between blue and purple. And these bridges are exactly the same thing we calculated above. More importantly, bridges between red and purple, bridges between blue and purple are independent! And so is bridges between red and blue. The three groups of bridges are independent from each other. Change bridges in one group will not break the constraints. So our final answer is multiply the three number together.</p>
<p>Here is my code:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ull unsigned ll</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> db double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PII pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mod 998244353</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">5010</span>;</span><br><span class="line">ll p[N],inv[N];</span><br><span class="line"><span class="function">ll <span class="title">C</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (((p[n]*inv[m])%mod)*inv[n-m])%mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qp</span><span class="params">(ll x,ll k)</span> </span>&#123;</span><br><span class="line">    ll ret=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (k&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k&amp;<span class="number">1</span>) ret=(ret*x)%mod;</span><br><span class="line">        k&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        x=(x*x)%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    p[<span class="number">0</span>]=<span class="number">1</span>;inv[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">5000</span>;i++) &#123;</span><br><span class="line">        p[i]=(p[i<span class="number">-1</span>]*i)%mod;</span><br><span class="line">        inv[i]=qp(p[i],mod<span class="number">-2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,a,a+<span class="number">1</span>,a+<span class="number">2</span>);</span><br><span class="line">    ll ans[<span class="number">3</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> x=i,y=(i+<span class="number">1</span>)%<span class="number">3</span>;</span><br><span class="line">        <span class="keyword">int</span> lim=min(a[x],a[y]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=lim;j++) &#123;</span><br><span class="line">            ll tmp=(((C(a[x],j)*C(a[y],j))%mod)*p[j])%mod;</span><br><span class="line">            ans[i]=(ans[i]+tmp)%mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ll res=(((ans[<span class="number">0</span>]*ans[<span class="number">1</span>])%mod)*ans[<span class="number">2</span>])%mod;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>I use multiplicative inverse to calculate compositions of big number, the editorial uses dynammic programming instead.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/10/10/cf-869C/" data-id="cjj4eq8ce0001fjjgvp8qtz99" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/codeforces/">codeforces</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/combinatorics/">combinatorics</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maths/">maths</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cf-864E" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/28/cf-864E/" class="article-date">
  <time datetime="2017-09-28T09:35:00.000Z" itemprop="datePublished">2017-09-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/competitive-programming/">competitive programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/28/cf-864E/">Codeforces 864E Fire</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Problem: <a href="http://codeforces.com/problemset/problem/864/E" target="_blank" rel="noopener">Codeforces 864E Fire</a></p>
<p>Well, we may easily think of the \’Knapsack\’ problem at the first glimpse of this problem. Luckily, with small modification on the solution to the \’Knapsack\’ problem we can solve this problem.</p>
<p>Let\’s use dynamic programming. Let dp[i][j] be the max total value of the first <em>i</em> items we can rescue in first <em>j</em> seconds. And we easily get <code>dp[i][j] = dp[i-1][j-t[i]] + p[i]</code>. Notice that j has to be smaller than d[i], or we cannot save this item and of course, larger than or equal to t[i]. And when we calculate the dp for answer, we have to iterate items in increasing order of their d[i]. You can simply figure out that, since the final answer must be with the latest time, and value for later time depends on value for earlier time.</p>
<p>And with the well-known trick for \’Knapsack\’ problem we can only use one-dimensional array as our <code>dp</code>.</p>
<p>My code:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ull unsigned ll</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> db double</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PII pair<span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2010</span>;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> t,d,p;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> t,d,p,id;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> node&amp; rhs) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> d&lt;rhs.d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;node&gt; a;</span><br><span class="line"><span class="keyword">int</span> dp[N];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec[N];</span><br><span class="line"><span class="keyword">int</span> idx=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;t,&amp;d,&amp;p);</span><br><span class="line">        a.pb(&#123;t,d,p,i&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(a.begin(),a.end());</span><br><span class="line">    <span class="keyword">int</span> mx=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=a[i].d<span class="number">-1</span>;j&gt;=a[i].t;j--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dp[j]&lt;dp[j-a[i].t]+a[i].p) &#123;</span><br><span class="line">                dp[j]=dp[j-a[i].t]+a[i].p;</span><br><span class="line">                vec[j]=vec[j-a[i].t];</span><br><span class="line">                vec[j].pb(a[i].id);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (mx&lt;dp[j]) &#123;</span><br><span class="line">                idx=j;</span><br><span class="line">                mx=dp[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,mx);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,(<span class="keyword">int</span>)vec[idx].size());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> ele:vec[idx]) <span class="built_in">printf</span>(<span class="string">"%d "</span>,ele);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/28/cf-864E/" data-id="cjj4eq8c90000fjjgz3n2fn1i" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/codeforces/">codeforces</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dynamic-programming/">dynamic programming</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cmake-link-issue" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/27/cmake-link-issue/" class="article-date">
  <time datetime="2017-09-27T07:15:27.000Z" itemprop="datePublished">2017-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/27/cmake-link-issue/">CMake link issue</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>When we use cmake to compile our program and use <code>TARGET_LINK_LIBRARIES</code> to link libraries we need, we have to pay attention to the order these libraries are specified.</p>
<p>In the following case, our program depends on the muduo_base library and muduo_base library depends on pthread, then we have to ensure pthread is after muduo_base:<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TARGET_LINK_LIBRARIES</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> <span class="variable">$&#123;MUDUO_NET_LIBRARY&#125;</span> <span class="variable">$&#123;MUDUO_BASE_LIBRARY&#125;</span> pthread)</span><br></pre></td></tr></table></figure><br>Otherwise, we would get a link error if we specify like this:<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TARGET_LINK_LIBRARIES</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> pthread <span class="variable">$&#123;MUDUO_NET_LIBRARY&#125;</span> <span class="variable">$&#123;MUDUO_BASE_LIBRARY&#125;</span>)</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/27/cmake-link-issue/" data-id="cjj4eq8da000rfjjgar4va64d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cmake/">cmake</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/competitive-programming/">competitive programming</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ad-hoc/">ad-hoc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmake/">cmake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/codeforces/">codeforces</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/combinatorics/">combinatorics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cpp/">cpp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dynamic-programming/">dynamic programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geometry/">geometry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maths/">maths</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/max-flow/">max-flow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/">net</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/state-compression/">state compression</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ad-hoc/" style="font-size: 10px;">ad-hoc</a> <a href="/tags/algorithm/" style="font-size: 20px;">algorithm</a> <a href="/tags/cmake/" style="font-size: 10px;">cmake</a> <a href="/tags/codeforces/" style="font-size: 16.67px;">codeforces</a> <a href="/tags/combinatorics/" style="font-size: 10px;">combinatorics</a> <a href="/tags/cpp/" style="font-size: 10px;">cpp</a> <a href="/tags/dynamic-programming/" style="font-size: 13.33px;">dynamic programming</a> <a href="/tags/geometry/" style="font-size: 10px;">geometry</a> <a href="/tags/maths/" style="font-size: 10px;">maths</a> <a href="/tags/max-flow/" style="font-size: 10px;">max-flow</a> <a href="/tags/net/" style="font-size: 10px;">net</a> <a href="/tags/state-compression/" style="font-size: 10px;">state compression</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/07/02/geometry-basics/">Geometry Basics</a>
          </li>
        
          <li>
            <a href="/2018/06/30/max-flow-algorithm/">Max Flow Algorithm</a>
          </li>
        
          <li>
            <a href="/2018/06/10/cf-984E/">Codeforces 984E Elevator</a>
          </li>
        
          <li>
            <a href="/2017/11/25/cf-894B/">Codeforces 894B Ralph And His Magic Field</a>
          </li>
        
          <li>
            <a href="/2017/11/07/notes-on-muduo-timer/">Notes on Muduo Timer</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Cao Li<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="/node_modules/live2d-widget/node_modules/live2d-widget/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"node_modules/live2d-widget/","pluginJsPath":"node_modules/live2d-widget/lib/","pluginModelPath":"node_modules/live2d-widget-model-hijiki/assets","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/node_modules/live2d-widget/node_modules/live2d-widget-model-hijiki/hijiki.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body>
</html>